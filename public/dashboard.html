<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel RH</title>
  <style>
    body {
      background-color: #f0f2f5;
      height: 100%;
      margin: 0;
      padding: 40px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
    }

    .card {
      background: white;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 400px;
      text-align: center;
      margin-bottom: 30px;
    }

    .card h2, .card h3 {
      margin-bottom: 20px;
      color: #333;
    }

    form {
      display: flex;
      flex-direction: column;
    }

    input, select, button {
      margin: 8px 0;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #0056b3;
    }

    .message {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #f44336;
      color: white;
      padding: 10px;
      border-radius: 5px;
      display: none;
    }

    .message.success {
      background-color: #4CAF50;
    }

    .message.error {
      background-color: #f44336;
    }

    #listaMedicos {
      text-align: left;
      background-color: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 800px;
      margin-bottom: 30px;
    }

    #listaMedicos h3 {
      margin-bottom: 10px;
    }

    #listaMedicos ul {
      list-style: none;
      padding: 0;
    }

    #listaMedicos li {
      margin-bottom: 12px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>Bem-vindo ao Painel de Cadastro do RH!</h2>
</div>

<!-- Formulário de Cadastro Médico -->
<div class="card">
  <h3>Cadastrar Médico</h3>
  <form id="cadastroMedicoForm">
    <input type="text" name="nome" placeholder="Nome do Médico" required>
    <input type="date" name="dataNascimento" placeholder="Data de Nascimento" required>
    <select name="sexo" required>
      <option value="">Sexo</option>
      <option value="M">Masculino</option>
      <option value="F">Feminino</option>
      <option value="O">Outro / Não binário</option>
      <option value="N">Prefere não informar</option>
    </select>
    <input type="text" name="telefone" placeholder="Telefone">
    <input type="text" name="cpf" placeholder="CPF">
    <input type="text" name="crm" placeholder="CRM ex:123456/SP" maxlength="30" required>
    <input type="email" name="email" placeholder="Email" required>
    <input type="text" name="endereco" placeholder="Endereço" required>
    <select name="especialidade" required>
      <option value="">Selecione a Especialidade Médica</option>
      <option value="Psiquiatria">Psiquiatria</option>
      <option value="Ortopedia">Ortopedia</option>
      <option value="Cardiologia">Cardiologia</option>
      <option value="Oftalmologia">Oftalmologia</option>
      <option value="Endocrinologia">Endocrinologia</option>
      <option value="Neurologia">Neurologia</option>
    </select>
    <button type="submit">Cadastrar Médico</button>
  </form>
</div>

<!-- Div para mensagens de sucesso ou erro -->
<div id="message" class="message"></div>

<!-- Botão de Logout -->
<div class="card">
  <a href="/logout">
    <button type="button">Sair</button>
  </a>
</div>

<!-- Botão para ir para a página de médicos cadastrados -->
<div class="card">
  <a href="/medicos.html">
    <button type="button">Ver Médicos Cadastrados</button>
  </a>
</div>

<script>
  // Envio do formulário
  document.getElementById('cadastroMedicoForm').addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = new FormData(this);
    const data = {};
    formData.forEach((value, key) => { data[key] = value });

    fetch('/cadastro-medico', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
      const messageDiv = document.getElementById('message');
      if (data.message) {
        messageDiv.textContent = data.message;
        messageDiv.classList.remove('error');
        messageDiv.classList.add('success');
        carregarMedicos(); // Recarrega lista após cadastro
      } else if (data.error) {
        messageDiv.textContent = data.error;
        messageDiv.classList.remove('success');
        messageDiv.classList.add('error');
      }

      messageDiv.style.display = 'block';
      setTimeout(() => { messageDiv.style.display = 'none'; }, 5000);
    })
    .catch(() => {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = 'Erro ao tentar cadastrar médico!';
      messageDiv.classList.add('error');
      messageDiv.style.display = 'block';
      setTimeout(() => { messageDiv.style.display = 'none'; }, 5000);
    });
  });

  // Função para carregar os médicos
  function carregarMedicos() {
    fetch('/medicos')
      .then(response => response.json())
      .then(data => {
        const lista = document.getElementById('medicosLista');
        if (!data || data.length === 0) {
          lista.innerHTML = '<li>Nenhum médico cadastrado ainda.</li>';
          return;
        }

        lista.innerHTML = '';
        data.forEach(medico => {
          lista.innerHTML += `
            <li>
              <strong>Nome:</strong> ${medico.nome} <br>
              <strong>CRM:</strong> ${medico.crm} <br>
              <strong>Email:</strong> ${medico.email} <br>
              <strong>Telefone:</strong> ${medico.telefone || 'Não informado'} <br>
              <strong>Especialidade:</strong> ${medico.especialidade}
            </li>
          `;
        });
      });
  }

  // Carrega os médicos ao entrar na página
  carregarMedicos();
</script>

</body>
</html>
